
---
title: "Heatmap"
author: "Jelmer en Sanne"
date: "24-1-2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Heatmapp function
## The working code behind the apllication. 

This function creates a heatmap out of the dataset, named heatmap_funtion. The input is the results from the DESeq2 analyse. The heatmap consists out of the top 20 genes. 
```{r}
heatmap_function <- function(se_input){
  
  ddsSE <- DESeq2::DESeqDataSet(se_input, design = formula(~dev_stage + genotype))
  
  keep <- rowSums(counts(ddsSE)) >= 10
  ddsSE <- ddsSE[keep,]
  
  ddsDE <- DESeq(ddsSE)
  
  ddsDE_rlog <- ddsDE %>%
    rlogTransformation() 
  
  
  
  matrix_results <- assay(ddsDE_rlog)
  
  ind <- matrix_results %>%
    rowMeans() %>%
    order(decreasing = TRUE) 
  
  top20 <- matrix_results[ind[1:20],]
  
  annot_df <- as.data.frame(colData(ddsDE)[,c("dev_stage","genotype")])
  
  heatmap <- pheatmap(top20,
                      scale = "row", 
                      annotation_col = annot_df)
  return(heatmap)
}
```

## Shiny 
### Server.R

The code below will create a heatmap. The input also consists of the summarized experiment, this is included for the DESeq2 analyse. 
```{r}
 heatmap_plot <- eventReactive(input$calculate_heatmap, {
      heatmap_function(se_input = se_2())
    })
    
   output$matrix_heatmap <- renderPlot ({
      heatmap_function(se_input = se_2())
    })
   
```
   
## UI.R

THe code below creates the plotoutput. 
```{r}
    box(
                title = "heatmap",
                width = "12",
                plotOutput("matrix_heatmap"))
```


